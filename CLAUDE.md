# Montafon Moonlight - Project Memory

## Project Overview

**Montafon Moonlight** is an English translation of a Korean serialized novel by **Jeong Chanju** (정찬주), a Buddhist novelist. The story follows the author's friendship with Austrian composer **Herbert Willi** in the alpine Montafon valley, exploring themes of Zen Buddhism, music, silence, and cross-cultural connection.

- **Live site:** https://omatty123.github.io/MontafonMoonlight/
- **Original Korean:** Published weekly on mediabuddha.net (section 40)
- **Total chapters planned:** 50
- **Current progress:** 22 chapters published (as of January 2026)

## Project History

- **Aug 2025:** Project created, first 11 chapters published
- **Oct 2025:** Added OG page generation for social sharing (`og/` folder)
- **Nov 2025:** Added Cast and Places pages with character info and maps
- **Dec 2025:** Added Korean article monitoring workflow (hourly checks)
- **Dec 2025:** Google Sheets sync automation failed and was disabled (corrupted chapters.json)
- **Jan 2026:** Fixed workflow race condition with retry logic

## File Structure

```
MontafonMoonlight/
├── index.html              # Homepage with chapter cards
├── chapter.html            # Chapter reader (loads from ?slug=...)
├── chapters.json           # Single source of truth for all chapter metadata
├── cast.html               # Cast of Characters page
├── places.html             # Places page with maps
├── content/                # Chapter HTML content files
│   └── chapter-{N}.html
├── assets/                 # Images and CSS
│   ├── ch{N}-cover.jpg     # Chapter cover images
│   ├── ch{N}-hero.jpg      # Chapter hero images
│   └── *.css               # Stylesheets
├── og/                     # Generated shareable URL pages (Open Graph)
│   └── {slug}.html         # Auto-generated by workflow
├── generate-chapters.js    # Script to generate og/ pages
├── translation-glossary.json  # Korean terms and character names
└── .github/workflows/
    ├── auto-generate.yml   # Generates og/ pages when chapters.json changes
    └── monitor-korean-article.yml  # Hourly check for new Korean articles
```

## Key Characters

| Korean | English | Role |
|--------|---------|------|
| 정찬주 | Jeong Chanju | Author/protagonist, Buddhist novelist |
| 박명숙 | Park Myeongsuk | Mrs. Park, author's wife, ceramic artist |
| 헤르베르트 빌리 | Herbert Willi | Austrian composer, "Mr. Willi" |
| 권숙녀 | Kwon Suk-nyeo | Chairwoman Kwon / Sonja Steindl-Kwon |
| 베르너 슈토킹거 | Werner Stockinger | Dr. Werner / Dr. Bae |

See `translation-glossary.json` for complete terminology reference.

## Workflows & Automation

### 1. OG Page Generator (`auto-generate.yml`)
- **Triggers:** Push to `chapters.json` or `generate-chapters.js`
- **Action:** Runs `node generate-chapters.js` to create shareable pages in `og/`
- **Output:** `og/{slug}.html` for each chapter with Open Graph meta tags
- **Fixed:** Now has retry logic for race conditions (Jan 2026)

### 2. Korean Article Monitor (`monitor-korean-article.yml`)
- **Triggers:** Hourly (cron) or manual
- **Action:** Checks mediabuddha.net for new "몬타폰의 달빛" articles
- **Output:** Creates GitHub Issue when new article detected

### Disabled Automation
- Google Sheets sync was disabled after corrupting chapters.json
- See `AUTOMATION.md` for details and recovery commands

## Adding a New Chapter

### Option 1: Web Workflow Tool (Recommended)

Use the **Chapter Workflow Tool**: https://omatty123.github.io/MontafonMoonlight/chapter-workflow-tool-v2.html

This tool automates the entire process:
1. **Paste Korean URL** → Auto-fetches text and image from mediabuddha.net
2. **Translate** → Generates Google Sheets formula for free translation
3. **Edit** → Side-by-side Korean/English editor with formatting preservation
4. **Metadata** → Auto-fills chapter number, image paths, generates slug
5. **Commit** → Direct GitHub commit with PAT token (or download files manually)

Features:
- Preserves bold/italic formatting from Google Docs
- Auto-italicizes Korean terms (jeong, hwadu, samadhi, etc.)
- Uploads both cover and hero images automatically
- Triggers the OG page generation workflow

### Option 2: Manual Process

1. **Add content:** Create `content/chapter-{N}.html` with the translated text
2. **Add images:** Upload `assets/ch{N}-cover.jpg` and `assets/ch{N}-hero.jpg`
3. **Update metadata:** Add entry to `chapters.json`:
   ```json
   {
     "title": "Chapter Title",
     "slug": "chapter-slug",
     "href": "chapter.html?slug=chapter-slug",
     "date": "YYYY-MM-DD",
     "cover": "assets/ch{N}-cover.jpg",
     "hero": "assets/ch{N}-hero.jpg",
     "summary": "One-line teaser",
     "status": "published",
     "contentHtml": "content/chapter-{N}.html",
     "koreanLink": "http://www.mediabuddha.net/m/news/view.php?number=XXXXX"
   }
   ```
4. **Commit & push:** The workflow auto-generates `og/{slug}.html`

## Common Commands

```bash
# Generate OG pages locally
node generate-chapters.js

# Check workflow status
gh run list --workflow=auto-generate.yml --limit 5

# View workflow logs
gh run view <run-id> --log

# Re-run failed workflow
gh run rerun <run-id> --failed
```

## Known Issues & Solutions

### Workflow push rejection (race condition)
- **Cause:** Another commit pushed while workflow running
- **Solution:** Workflow now has retry logic with `git pull --rebase`

### chapters.json corruption
- **Cause:** Broken Google Sheets sync (disabled)
- **Recovery:** `git checkout <good-commit> -- chapters.json`

## Progress Tracker

- Chapters 1-22: Published
- Chapters 23-50: Remaining (28 chapters)
- Publishing pace: ~1 chapter per week

## Future Goal: Print Book

When all 50 chapters are complete, create a printed book. Considerations:

### Content Compilation
- Combine all 50 chapter HTML files into single manuscript
- Review for consistency (character names, terminology, formatting)
- Add front matter (title page, copyright, dedication, table of contents)
- Add back matter (about the author, glossary of Korean/Buddhist terms)

### Illustrations
- Current: Web-optimized JPGs by artist Jeong Yun-gyeong
- Need: High-resolution versions for print (300 DPI minimum)
- Consider: Full-page chapter openers vs inline illustrations

### Formatting Options
- **PDF** for print-ready files
- **ePub** for ebook distribution
- Tools: Pandoc, LaTeX, Adobe InDesign, or Vellum (Mac)

### Print-on-Demand Services
- Amazon KDP (Kindle Direct Publishing) - widest reach
- IngramSpark - better bookstore distribution
- Lulu - good for small runs
- Blurb - premium quality photo books

### ISBN & Copyright
- Obtain ISBN for official publication
- Copyright registration
- Consider Korean rights coordination with original author

### Special Editions
- Bilingual edition (Korean/English parallel text)?
- Illustrated collector's edition?
- Audiobook narration?

### Technical Tasks (when ready)
- Script to compile chapters into single document
- Generate table of contents from chapters.json
- Export glossary from translation-glossary.json
- Create print-ready PDF with proper margins/bleeds

## Useful Links

- **Workflow Tool:** https://omatty123.github.io/MontafonMoonlight/chapter-workflow-tool-v2.html
- **Korean Source:** http://www.mediabuddha.net/m/news/section.php?section=40
- **GitHub Repo:** https://github.com/omatty123/MontafonMoonlight
