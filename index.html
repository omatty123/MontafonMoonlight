<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Home • The Chronicles of Ethereal Realm</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet" />
  <style>
    :root { --primary-color:#2563eb; --secondary-color:#94a3b8; --text-color:#f9fafb; --bg-color:#0b1220; --card:#111827; --border-color:#374151; }
    [data-theme="light"] { --secondary-color:#64748b; --text-color:#1f2937; --bg-color:#ffffff; --card:#f9fafb; --border-color:#e5e7eb; }
    body { font-family:'Crimson Text', serif; color:var(--text-color); background:var(--bg-color); transition: background .2s, color .2s; }
    .ui-text { font-family:'Inter', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial; }
    .chapter-card { background:var(--card); border:1px solid var(--border-color); border-radius:.75rem; overflow:hidden; display:flex; flex-direction:column; transition:transform .2s, box-shadow .2s; }
    .chapter-card:hover { transform: translateY(-2px); box-shadow:0 10px 25px rgba(0,0,0,.25); }
    .cover { aspect-ratio: 3 / 2; width:100%; object-fit:cover; display:block; }
    .badge { position:absolute; top:.5rem; left:.5rem; }
  </style>
</head>
<body>
  <header class="sticky top-0 z-40" style="background:var(--bg-color); border-bottom:1px solid var(--border-color);">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
      <div class="flex items-center justify-between">
        <div class="min-w-0">
          <h1 class="ui-text font-bold text-2xl" style="color:#3b82f6;"><i class="fas fa-book mr-2"></i> The Chronicles of Ethereal Realm</h1>
          <p class="ui-text text-sm" style="color:var(--secondary-color);">Translated from Chinese | Updates weekly</p>
        </div>
        <div class="flex items-center gap-3">
          <button id="theme-toggle" class="p-2 rounded" style="background:var(--card);" aria-label="Toggle theme"><i class="fas fa-moon"></i></button>
        </div>
      </div>
    </div>
  </header>

  <section class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <div class="text-center mb-6">
      <h2 class="text-4xl font-bold mb-3">Welcome</h2>
      <p class="ui-text text-base sm:text-lg mx-auto max-w-3xl" style="color:var(--secondary-color);">A serial translation project. New chapters post on Mondays. Browse below and jump in.</p>
    </div>
    <div class="ui-text text-sm flex flex-wrap items-center justify-center gap-6" style="color:var(--secondary-color);">
      <span id="statChapters">Chapters: 0</span>
      <span id="statWords">Total words: 0</span>
      <span id="statUpdated">Last updated: —</span>
    </div>
  </section>

  <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pb-16">
    <div class="ui-text text-sm mb-4 flex items-center gap-3">
      <label class="inline-flex items-center gap-2"><input id="toggleDrafts" type="checkbox" class="form-checkbox"> <span>Show drafts</span></label>
    </div>
    <h3 class="text-2xl font-bold mb-6">Latest chapters</h3>
    <div id="grid" class="grid gap-8 sm:grid-cols-2 md:grid-cols-3"></div>
  </main>

  <footer class="border-t py-8" style="border-color:var(--border-color);">
    <div class="text-center">
      <p class="ui-text mb-2" style="color:var(--secondary-color);">Translation © 2025 • <a href="#" class="hover:underline" style="color:#3b82f6;">Support the original author</a></p>
      <nav class="ui-text text-sm">
        <a href="index.html" class="hover:underline" style="color:#3b82f6;">Home</a> · 
        <a id="startLink" href="#" class="hover:underline" style="color:#3b82f6;">Start reading</a> · 
        <a id="downloadRSS" href="#" class="hover:underline" style="color:#3b82f6;">Download RSS</a> ·
        <a id="downloadSitemap" href="#" class="hover:underline" style="color:#3b82f6;">Download sitemap</a>
      </nav>
    </div>
  </footer>

  <script>
    const SITE = { title:'The Chronicles of Ethereal Realm', description:'Serialized translation project — new chapters every Monday.', baseUrl:'https://omatty123.github.io/MontafonMoonlight/' };

    // Theme
    (function(){
      const btn=document.getElementById('theme-toggle'); const root=document.documentElement;
      const saved=localStorage.getItem('theme')||'dark'; if(saved==='dark') root.removeAttribute('data-theme'); else root.setAttribute('data-theme','light');
      btn.addEventListener('click', ()=>{ const isLight=root.getAttribute('data-theme')==='light'; if(isLight){root.removeAttribute('data-theme'); localStorage.setItem('theme','dark');} else {root.setAttribute('data-theme','light'); localStorage.setItem('theme','light');} });
    })();

    async function loadChapters(){
      const res = await fetch('chapters.json', {cache:'no-store'});
      return res.ok ? res.json() : [];
    }
    const commas=(x)=>(x||0).toLocaleString();
    const fmt=(d)=> new Date(d).toLocaleDateString(undefined,{year:'numeric',month:'short',day:'numeric'});
    function card(c){
      const href = c.href || `chapter.html?slug=${encodeURIComponent(c.slug)}`;
      return \`
      <article class="chapter-card relative">
        <a href="\${href}"><img class="cover" src="\${c.cover}" alt="\${c.title} cover" loading="lazy"></a>
        <div class="p-4">
          <h4 class="text-lg font-semibold mb-1"><a class="hover:underline" href="\${href}">\${c.title}</a></h4>
          <p class="ui-text text-sm mb-2" style="color:var(--secondary-color);">
            <i class="fas fa-calendar mr-1"></i> \${fmt(c.date)} ·
            <i class="fas fa-clock ml-3 mr-1"></i> ~\${c.readTime} min ·
            <i class="fas fa-eye ml-3 mr-1"></i> \${commas(c.words)} words
          </p>
          <p class="ui-text text-sm">\${c.summary||''}</p>
        </div>
      </article>\`;
    }
    function stats(list){
      document.getElementById('statChapters').textContent = 'Chapters: ' + list.length;
      const total = list.reduce((s,c)=>s+(c.words||0),0);
      document.getElementById('statWords').textContent = 'Total words: ' + commas(total);
      const last = list[list.length-1]; // ascending
      if(last) document.getElementById('statUpdated').textContent = 'Last updated: ' + fmt(last.date);
      document.getElementById('startLink').href = (list[0] && (list[0].href || 'chapter.html?slug='+encodeURIComponent(list[0].slug))) || '#';
    }
    (async function(){
      if(!SITE.baseUrl || SITE.baseUrl.indexOf('http')!==0){ SITE.baseUrl = location.origin + location.pathname.replace(/index\.html?$/i,''); }
      const data = await loadChapters();
      // sort ascending (1,2,3)
      data.sort((a,b)=> new Date(a.date)-new Date(b.date));
      const pubs = data.filter(c=> (c.status||'published')==='published');
      stats(pubs);
      const grid=document.getElementById('grid');
      const cb=document.getElementById('toggleDrafts');
      function render(showDrafts){ const list = showDrafts? data : pubs; grid.innerHTML = list.map(card).join(''); }
      render(false);
      cb.addEventListener('change', ()=>render(cb.checked));
      document.getElementById('downloadRSS').addEventListener('click', (e)=>{e.preventDefault(); const rss = '<rss version="2.0"><channel><title>'+SITE.title+'</title></channel></rss>'; const blob=new Blob([rss],{type:'application/xml'}); const u=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=u; a.download='feed.xml'; a.click(); setTimeout(()=>URL.revokeObjectURL(u),0);});
      document.getElementById('downloadSitemap').addEventListener('click', (e)=>{e.preventDefault(); const urls = pubs.map(c=>'<url><loc>'+SITE.baseUrl+(c.href || ('chapter.html?slug='+encodeURIComponent(c.slug)))+'</loc></url>').join(''); const sm='<?xml version="1.0" encoding="UTF-8"?><urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">'+urls+'</urlset>'; const blob=new Blob([sm],{type:'application/xml'}); const u=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=u; a.download='sitemap.xml'; a.click(); setTimeout(()=>URL.revokeObjectURL(u),0);});
    })();
  </script>
</body>
</html>
