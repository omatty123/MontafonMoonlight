<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Home • Moonlight of Montafon</title>

  <!-- Site theme tokens (light/dark) -->
  <link rel="stylesheet" href="assets/theme.css">

  <!-- Fonts (Inter matches the header font you liked) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet" />

  <!-- Tailwind + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" />

  <style>
    /* Consistent UI font everywhere */
    html, body, h1, h2, h3, h4, h5, h6, p, a, span, li, nav, div, small, button {
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif !important;
    }
    /* Cards */
    .chapter-card {
      background: var(--bg, #fff);
      border: 1px solid var(--border, #e5e7eb);
      border-radius: .75rem;
      overflow: hidden;
      transition: transform .2s, box-shadow .2s;
    }
    .chapter-card:hover { transform: translateY(-2px); box-shadow: 0 10px 24px rgba(0,0,0,.12); }
    .cover { aspect-ratio: 3/2; width: 100%; object-fit: cover; display: block; }
    /* Header uses theme variables from assets/theme.css */
    header.stickybar {
      position: sticky; top: 0; z-index: 40;
      background: var(--bg, #fff);
      border-bottom: 1px solid var(--border, #e5e7eb);
    }
    .muted { color: var(--muted, #64748b); }
    .brand { color: #2563eb; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">

  <!-- Header -->
  <header class="stickybar">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
      <div class="min-w-0">
        <h1 class="font-bold text-2xl brand"><i class="fas fa-book mr-2"></i> Moonlight of Montafon</h1>
        <p class="text-sm muted">Translated from Korean • Updates weekly</p>
      </div>
      <button id="theme-toggle" class="p-2 rounded border border-gray-300 muted" aria-label="Toggle theme" title="Toggle theme">
        <i class="fas fa-moon"></i>
      </button>
    </div>
  </header>

  <!-- Hero -->
  <section class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 pt-10 pb-6 text-center">
    <h2 class="text-4xl font-bold mb-2">Moonlight of Montafon</h2>
    <p class="text-lg muted mb-4">몬타폰의 달빛 (Original Korean Title)</p>
    <div class="flex justify-center gap-6 text-sm muted">
      <span><i class="fas fa-user mr-1"></i> Author: Jeong Chanju</span>
      <span><i class="fas fa-language mr-1"></i> Translator: Matty Wegehaupt</span>
      <span><i class="fas fa-calendar mr-1"></i> Started: August 2025</span>
    </div>
  </section>

  <!-- Stats -->
  <section class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 pb-6 text-center">
    <p class="text-base muted mb-2">A serial translation project. New chapters weekly. Browse below and jump in.</p>
    <div class="flex justify-center gap-6 text-sm muted">
      <span id="statChapters">Chapters: —</span>
      <span id="statUpdated">Last updated: —</span>
    </div>
  </section>

  <!-- Chapters grid -->
  <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pb-16">
    <h3 class="text-2xl font-bold mb-6">Latest chapters</h3>
    <div id="grid" class="grid gap-8 sm:grid-cols-2 md:grid-cols-3"></div>
  </main>

  <!-- (No footer nav, per your request) -->

  <!-- Theme toggle (persistent + system-aware) -->
  <script>
  (function () {
    const STORAGE_KEY = "theme";         // "light" | "dark"
    const root = document.documentElement;
    const btn  = document.getElementById("theme-toggle");

    function apply(theme) {
      if (theme === "dark") root.setAttribute("data-theme","dark");
      else root.removeAttribute("data-theme"); // light/default
    }
    function initial() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved === "dark" || saved === "light") return saved;
      return matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
    }
    function reflect(theme) {
      if (!btn) return;
      btn.setAttribute("aria-pressed", theme === "dark" ? "true" : "false");
      btn.title = theme === "dark" ? "Switch to light mode" : "Switch to dark mode";
    }

    let current = initial();
    apply(current); reflect(current);

    const mq = matchMedia("(prefers-color-scheme: dark)");
    function onSystem(e) {
      if (localStorage.getItem(STORAGE_KEY)) return; // user chose; don't override
      current = e.matches ? "dark" : "light";
      apply(current); reflect(current);
    }
    mq.addEventListener?.("change", onSystem);

    if (btn) {
      btn.addEventListener("click", () => {
        current = current === "dark" ? "light" : "dark";
        localStorage.setItem(STORAGE_KEY, current);
        apply(current); reflect(current);
      });
    }
  })();
  </script>

  <!-- Build chapter cards -->
  <script>
  (async function(){
    const commas = n => (n||0).toLocaleString();
    const fmt = d => new Date(d).toLocaleDateString(
      undefined, {year:'numeric', month:'short', day:'numeric'}
    );

    function card(c){
      const href = c.href || `chapter.html?slug=${encodeURIComponent(c.slug)}`;
      return `
      <article class="chapter-card">
        <a href="${href}"><img src="${c.cover}" alt="${c.title} cover" class="cover"></a>
        <div class="p-4">
          <h4 class="text-lg font-semibold mb-1">
            <a href="${href}" class="text-blue-600 hover:underline">${c.title}</a>
          </h4>
          <p class="text-sm muted mb-2">
            <i class="fas fa-calendar mr-1"></i> ${fmt(c.date)} ·
            <i class="fas fa-clock ml-3 mr-1"></i> ~${c.readTime} min ·
            <i class="fas fa-eye ml-3 mr-1"></i> ${commas(c.words)} words
          </p>
          <p class="text-sm">${c.summary||''}</p>
        </div>
      </article>`;
    }

    // Fetch with cache-bust to avoid GH Pages caching
    let data = [];
    try {
      const r = await fetch('chapters.json?v=' + Date.now(), {cache:'no-store'});
      data = r.ok ? await r.json() : [];
    } catch(e) { data = []; }

    // Sort ascending; show only published
    data.sort((a,b)=> new Date(a.date) - new Date(b.date));
    const pubs = data.filter(c => (c.status || 'published') === 'published');

    // Stats
    const statCh = document.getElementById('statChapters');
    const statUp = document.getElementById('statUpdated');
    if (statCh) statCh.textContent = 'Chapters: ' + pubs.length;
    if (statUp && pubs.length) statUp.textContent = 'Last updated: ' + fmt(pubs[pubs.length-1].date);

    // Grid
    const grid = document.getElementById('grid');
    if (grid) grid.innerHTML = pubs.map(card).join('');
  })();
  </script>
</body>
</html>
