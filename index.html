<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Home • Moonlight of Montafon</title>

  <!-- Fonts (Inter like your header) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet" />

  <!-- Tailwind + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" />

  <style>
    /* Use Inter everywhere for consistent titles/body like your screenshot */
    body, h1, h2, h3, h4, h5, h6, p, a, span, li, nav, div { font-family: 'Inter', sans-serif !important; }

    /* Card styling */
    .chapter-card { background:#fff; border:1px solid #e5e7eb; border-radius:.75rem; overflow:hidden; transition:transform .2s, box-shadow .2s; }
    .chapter-card:hover { transform: translateY(-2px); box-shadow:0 10px 25px rgba(0,0,0,.1); }
    .cover { aspect-ratio: 3 / 2; width:100%; object-fit:cover; }

    /* --- Dark mode overrides (minimal but effective) --- */
    html[data-theme="dark"] body { background:#0b1220; color:#f9fafb; }
    html[data-theme="dark"] .bg-white    { background:#111827 !important; }
    html[data-theme="dark"] .bg-gray-50  { background:#0b1220 !important; }
    html[data-theme="dark"] .text-gray-900 { color:#f9fafb !important; }
    html[data-theme="dark"] .text-gray-500 { color:#94a3b8 !important; }
    html[data-theme="dark"] .border-gray-200 { border-color:#374151 !important; }
    html[data-theme="dark"] .chapter-card { background:#111827; border-color:#374151; }
    html[data-theme="dark"] a.text-blue-600 { color:#8ab4ff !important; }
  </style>
</head>

<body class="bg-gray-50 text-gray-900">
  <!-- Header -->
  <header class="sticky top-0 z-40 bg-white border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
      <div>
        <h1 class="font-bold text-2xl text-blue-600">
          <i class="fas fa-book mr-2"></i> Moonlight of Montafon
        </h1>
        <p class="text-sm text-gray-500">Translated from Korean • Updates weekly</p>
      </div>
      <!-- THE ONLY TOGGLE BUTTON -->
      <button id="theme-toggle" class="p-2 rounded border text-gray-600" aria-label="Toggle theme" title="Switch theme">
        <i class="fas fa-moon"></i>
      </button>
    </div>
  </header>

  <!-- Hero -->
  <section class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 pt-10 pb-6 text-center">
    <h2 class="text-4xl font-bold mb-2">Moonlight of Montafon</h2>
    <p class="text-lg text-gray-500 mb-4">몬타폰의 달빛 (Original Korean Title)</p>
    <div class="flex justify-center space-x-6 text-sm text-gray-500">
      <span><i class="fas fa-user mr-1"></i> Author: Jeong Chanju</span>
      <span><i class="fas fa-language mr-1"></i> Translator: Matty Wegehaupt</span>
      <span><i class="fas fa-calendar mr-1"></i> Started: August 2025</span>
    </div>
  </section>

  <!-- Stats -->
  <section class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 pb-6 text-center">
    <p class="text-base text-gray-500 mb-2">
      A serial translation project. New chapters weekly. Browse below and jump in.
    </p>
    <div class="flex justify-center space-x-6 text-sm text-gray-500">
      <span id="statChapters">Chapters: 0</span>
      <span id="statUpdated">Last updated: —</span>
    </div>
  </section>

  <!-- Chapters -->
  <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pb-16">
    <h3 class="text-2xl font-bold mb-6">Latest chapters</h3>
    <div id="grid" class="grid gap-8 sm:grid-cols-2 md:grid-cols-3"></div>
  </main>

  <!-- Footer -->
  <footer class="border-t py-8 text-center text-sm text-gray-500">
    <p>Translation © 2025 • <a href="#" class="text-blue-600 hover:underline">Support the original author</a></p>
    <nav class="space-x-4">
      <a href="index.html" class="text-blue-600 hover:underline">Home</a>
      <a id="startLink" href="#" class="text-blue-600 hover:underline">Start reading</a>
      <a id="downloadRSS" href="#" class="text-blue-600 hover:underline">Download RSS</a>
      <a id="downloadSitemap" href="#" class="text-blue-600 hover:underline">Download sitemap</a>
    </nav>
  </footer>

  <!-- Data + Render -->
  <script>
    async function loadChapters(){
      try{
        const res = await fetch('chapters.json', {cache:'no-store'});
        return res.ok ? await res.json() : [];
      }catch(_){ return []; }
    }
    const commas = n => (n||0).toLocaleString();
    const fmt = d => new Date(d).toLocaleDateString(undefined,{year:'numeric',month:'short',day:'numeric'});

    function card(c){
      const href = c.href || `chapter.html?slug=${encodeURIComponent(c.slug)}`;
      return `
      <article class="chapter-card">
        <a href="${href}"><img src="${c.cover}" alt="${c.title} cover" class="cover" loading="lazy"></a>
        <div class="p-4">
          <h4 class="text-lg font-semibold mb-1"><a href="${href}" class="text-blue-600 hover:underline">${c.title}</a></h4>
          <p class="text-sm text-gray-500 mb-2">
            <i class="fas fa-calendar mr-1"></i> ${fmt(c.date)} ·
            <i class="fas fa-clock ml-3 mr-1"></i> ~${c.readTime||'—'} min ·
            <i class="fas fa-eye ml-3 mr-1"></i> ${commas(c.words)}
          </p>
          <p class="text-sm">${c.summary||''}</p>
        </div>
      </article>`;
    }

    function stats(list){
      document.getElementById('statChapters').textContent = 'Chapters: ' + list.length;
      if(list.length){
        const last = list[list.length-1];
        document.getElementById('statUpdated').textContent = 'Last updated: ' + fmt(last.date);
        document.getElementById('startLink').href = last.href || ('chapter.html?slug='+encodeURIComponent(last.slug));
      }
    }

    (async function(){
      const data = await loadChapters();
      data.sort((a,b)=> new Date(a.date) - new Date(b.date)); // 1 → 2 → 3
      const pubs = data.filter(c => (c.status||'published') === 'published');
      stats(pubs);
      document.getElementById('grid').innerHTML = pubs.map(card).join('');
    })();
  </script>

  <!-- Theme Toggle (single source of truth) -->
  <script>
    (function () {
      const STORAGE_KEY = "theme";     // "light" | "dark"
      const root = document.documentElement;
      const btn  = document.getElementById("theme-toggle");

      function apply(theme){ theme === "dark" ? root.setAttribute("data-theme","dark") : root.setAttribute("data-theme","light"); }
      function initial(){
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved === "dark" || saved === "light") return saved;
        return matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
      }
      function reflect(theme){
        if(!btn) return;
        btn.setAttribute("aria-pressed", theme==="dark" ? "true":"false");
        btn.title = theme==="dark" ? "Switch to light mode" : "Switch to dark mode";
        btn.innerHTML = theme==="dark" ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
      }

      let current = initial();
      apply(current); reflect(current);

      const mq = matchMedia("(prefers-color-scheme: dark)");
      mq.addEventListener?.("change", e => {
        if (localStorage.getItem(STORAGE_KEY)) return; // don't override user choice
        current = e.matches ? "dark" : "light";
        apply(current); reflect(current);
      });

      btn?.addEventListener("click", () => {
        current = (current === "dark") ? "light" : "dark";
        localStorage.setItem(STORAGE_KEY, current);
        apply(current); reflect(current);
      });
    })();
  </script>
</body>
</html>
